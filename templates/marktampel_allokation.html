{% extends "base.html" %}

{% block title %}Marktampel & Allokation - Didis Premium Trading Academy{% endblock %}

{% block head %}
<style>
    /* Import Inter Font */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    /* Reset und Override base.html styles */
    .marktampel-page * {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
    }
    
    .marktampel-page {
        background: #f7f7f7 !important;
        line-height: 1.6 !important;
        font-size: 1.05em !important;
        min-height: 100vh;
        padding: 0 !important;
    }
    
    .marktampel-page .container-fluid {
        max-width: 1200px !important;
        margin: 0 auto !important;
        padding: 0 20px !important;
    }
    
    /* Hero Header mit Prim√§r-Verlauf */
    .marktampel-page .main-header {
        background: linear-gradient(135deg, #1a1a1a 0%, #b8860b 100%);
        padding: 40px;
        border-radius: 12px;
        color: white;
        text-align: center;
        margin-bottom: 40px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
    }
    
    .main-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(218, 165, 32, 0.1) 0%, rgba(184, 134, 11, 0.1) 100%);
        pointer-events: none;
    }
    
    .main-header h1 {
        font-size: 2.8em;
        font-weight: 800;
        margin-bottom: 15px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .main-header p {
        font-size: 1.2em;
        opacity: 0.9;
        font-weight: 400;
    }
    
    /* Glasmorphismus Metric Cards */
    .metric-card {
        background: rgba(255, 255, 255, 0.95);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #daa520;
        margin-bottom: 20px;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .metric-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        border-left-color: #b8860b;
    }
    
    .metric-card strong {
        color: #1a1a1a;
        font-weight: 600;
        display: block;
        margin-bottom: 8px;
    }
    
    /* Regime Cards mit Gold-Akzenten */
    .regime-card {
        padding: 20px;
        border-radius: 12px;
        margin: 10px 0;
        border: 2px solid #e5e7eb;
        text-align: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .regime-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .regime-preferred { 
        background: linear-gradient(135deg, #38a169 0%, #2f855a 100%) !important;
        border-color: #38a169 !important;
        border-left: 4px solid #2d7a4e !important;
        color: white !important;
    }
    
    .regime-preferred * {
        color: white !important;
    }
    
    .regime-avoid { 
        background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%) !important;
        border-color: #e53e3e !important;
        border-left: 4px solid #b82a2a !important;
        color: white !important;
    }
    
    .regime-avoid * {
        color: white !important;
    }
    
    .regime-neutral { 
        background: linear-gradient(135deg, #d69e2e 0%, #b7791f 100%) !important;
        border-color: #d69e2e !important;
        border-left: 4px solid #9c6a1b !important;
        color: white !important;
    }
    
    .regime-neutral * {
        color: white !important;
    }
    
    .regime-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
    }
    
    .regime-card strong {
        color: white !important;
        font-weight: 700;
        font-size: 1.1em;
        display: block;
        margin-bottom: 8px;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }
    
    /* Portfolio Slider mit Gold-Design */
    .portfolio-slider {
        margin: 20px 0;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(218, 165, 32, 0.1);
    }
    
    .portfolio-slider label {
        display: block;
        font-weight: 600;
        margin-bottom: 12px;
        color: #1a1a1a;
        font-size: 1.1em;
    }
    
    .slider-container {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .slider-container input[type="range"] {
        flex: 1;
        height: 8px;
        border-radius: 5px;
        background: linear-gradient(to right, #f4e97b 0%, #daa520 50%, #b8860b 100%);
        outline: none;
        appearance: none;
        cursor: pointer;
    }
    
    .slider-container input[type="range"]::-webkit-slider-thumb {
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: linear-gradient(135deg, #daa520 0%, #b8860b 100%);
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }
    
    .slider-container input[type="range"]::-webkit-slider-thumb:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .slider-value {
        min-width: 60px;
        font-weight: 700;
        color: #b8860b;
        font-size: 1.1em;
        text-align: center;
        background: rgba(218, 165, 32, 0.1);
        padding: 8px 12px;
        border-radius: 8px;
    }
    
    #portfolio-chart {
        width: 100%;
        height: 450px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        padding: 20px;
    }
    
    /* Alert Boxen mit Gold-Design */
    .alert {
        padding: 20px;
        border-radius: 12px;
        margin: 20px 0;
        font-weight: 500;
        position: relative;
        overflow: hidden;
    }
    
    .alert::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
    }
    
    .alert-error {
        background: linear-gradient(135deg, rgba(229, 62, 62, 0.1) 0%, rgba(229, 62, 62, 0.05) 100%);
        border: 1px solid rgba(229, 62, 62, 0.2);
        color: #e53e3e;
    }
    
    .alert-error::before {
        background: #e53e3e;
    }
    
    .alert-success {
        background: linear-gradient(135deg, rgba(56, 161, 105, 0.1) 0%, rgba(56, 161, 105, 0.05) 100%);
        border: 1px solid rgba(56, 161, 105, 0.2);
        color: #38a169;
    }
    
    .alert-success::before {
        background: #38a169;
    }
    
    .alert-info {
        background: linear-gradient(135deg, rgba(218, 165, 32, 0.1) 0%, rgba(218, 165, 32, 0.05) 100%);
        border: 1px solid rgba(218, 165, 32, 0.2);
        color: #b8860b;
    }
    
    .alert-info::before {
        background: #daa520;
    }
    
    /* Premium Tab Design */
    .tabs {
        display: flex;
        border-bottom: 2px solid rgba(218, 165, 32, 0.2);
        margin-bottom: 40px;
        background: white;
        border-radius: 12px 12px 0 0;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    .tab {
        padding: 20px 30px;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        color: #6b7280;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
        position: relative;
        flex: 1;
        text-align: center;
    }
    
    .tab:hover {
        background: rgba(218, 165, 32, 0.05);
        color: #b8860b;
    }
    
    .tab.active {
        color: #b8860b;
        border-bottom-color: #daa520;
        background: rgba(218, 165, 32, 0.1);
        font-weight: 700;
    }
    
    .tab-content {
        display: none;
        animation: fadeIn 0.3s ease-in-out;
    }
    
    .tab-content.active {
        display: block;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Sidebar mit Premium-Design */
    .sidebar-stats {
        background: linear-gradient(135deg, #ffffff 0%, rgba(244, 233, 123, 0.1) 100%);
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 40px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(218, 165, 32, 0.1);
    }
    
    .sidebar-stats h4, .sidebar-stats h5 {
        color: #1a1a1a;
        font-weight: 700;
        margin-bottom: 20px;
    }
    
    /* Content Cards */
    .content-card {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        border: 1px solid rgba(218, 165, 32, 0.1);
        transition: all 0.3s ease;
    }
    
    .content-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }
    
    .content-card h2, .content-card h4 {
        color: #1a1a1a;
        font-weight: 700;
        margin-bottom: 20px;
    }
    
    /* Form Controls */
    .form-control, select {
        border: 2px solid rgba(218, 165, 32, 0.2);
        border-radius: 8px;
        padding: 12px 16px;
        font-size: 16px;
        transition: all 0.3s ease;
        background: white;
    }
    
    .form-control:focus, select:focus {
        border-color: #daa520;
        box-shadow: 0 0 0 3px rgba(218, 165, 32, 0.1);
        outline: none;
    }
    
    /* Sector Performance Table Styles */
    .table-responsive {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }
    
    #sector-performance-table {
        margin: 0;
        border: none;
        background: white;
    }
    
    #sector-performance-table th {
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 14px;
        border: none;
    }
    
    #sector-performance-table td {
        padding: 12px 15px;
        border: none;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        font-weight: 500;
        vertical-align: middle;
    }
    
    #sector-performance-table tr:hover {
        background: rgba(218, 165, 32, 0.05);
    }
    
    .performance-positive {
        color: #38a169;
        font-weight: 600;
    }
    
    .performance-negative {
        color: #e53e3e;
        font-weight: 600;
    }
    
    .performance-neutral {
        color: #d69e2e;
        font-weight: 600;
    }
    
    .sector-symbol {
        font-family: 'Courier New', monospace;
        font-weight: 700;
        color: #1a1a1a;
        background: rgba(218, 165, 32, 0.1);
        padding: 4px 8px;
        border-radius: 4px;
        display: inline-block;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .main-header {
            padding: 30px 20px;
        }
        
        .main-header h1 {
            font-size: 2.2em;
        }
        
        .tabs {
            flex-direction: column;
        }
        
        .tab {
            text-align: left;
            border-bottom: 1px solid rgba(218, 165, 32, 0.2);
            border-left: 3px solid transparent;
        }
        
        .tab.active {
            border-left-color: #daa520;
            border-bottom-color: transparent;
        }
        
        .portfolio-slider {
            padding: 15px;
        }
        
        .slider-container {
            flex-direction: column;
            gap: 10px;
        }
        
        .slider-value {
            align-self: center;
        }
        
        /* Mobile table adjustments */
        #sector-performance-table {
            font-size: 14px;
        }
        
        #sector-performance-table th,
        #sector-performance-table td {
            padding: 8px 10px;
        }
        
        .sector-symbol {
            font-size: 12px;
            padding: 2px 6px;
        }
    }
</style>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
{% endblock %}

{% block content %}
<div class="marktampel-page">
    <div class="container-fluid">
        <!-- Main Header -->
        <div class="main-header">
            <h1>üìà {{ module.title if module else 'Marktampel & Allokation' }}</h1>
            <p>Professionelle Trading-Analyse & Portfolio-Management</p>
        </div>

        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3">
        </div>

        <!-- Main Content -->
        <div class="col-md-9">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('portfolio')">üìä Portfolio Analyzer</button>
                <button class="tab" onclick="showTab('trading')">üìà Live Trading</button>
            </div>

            <!-- Portfolio Tab -->
            <div id="portfolio-tab" class="tab-content active">
                <div class="content-card">
                    <h2>0.1 Marktampel & Allokation</h2>
                    <p style="color: #6b7280; font-size: 1.1em; margin-bottom: 30px;">
                        Optimiere dein Portfolio basierend auf verschiedenen Marktregimen und maximiere deine Rendite bei kontrolliertem Risiko.
                    </p>
                </div>
                
                <div class="row">
                    <!-- Portfolio Input -->
                    <div class="col-md-4">
                        <div class="content-card">
                            <h4>üéØ Portfolio Allocation</h4>
                            
                            <div class="portfolio-slider">
                                <label for="cash">üí∞ Cash (%)</label>
                                <div class="slider-container">
                                    <input type="range" id="cash" min="0" max="100" value="0" oninput="updatePortfolio()">
                                    <span class="slider-value" id="cash-value">0%</span>
                                </div>
                            </div>
                            
                            <div class="portfolio-slider">
                                <label for="sp500">üìà S&P 500 ETF (%)</label>
                                <div class="slider-container">
                                    <input type="range" id="sp500" min="0" max="100" value="60" oninput="updatePortfolio()">
                                    <span class="slider-value" id="sp500-value">60%</span>
                                </div>
                            </div>
                            
                            <div class="portfolio-slider">
                                <label for="gold">üèÜ Gold (%)</label>
                                <div class="slider-container">
                                    <input type="range" id="gold" min="0" max="100" value="30" oninput="updatePortfolio()">
                                    <span class="slider-value" id="gold-value">30%</span>
                                </div>
                            </div>
                            
                            <div class="portfolio-slider">
                                <label for="bitcoin">‚Çø Bitcoin (%)</label>
                                <div class="slider-container">
                                    <input type="range" id="bitcoin" min="0" max="100" value="10" oninput="updatePortfolio()">
                                    <span class="slider-value" id="bitcoin-value">10%</span>
                                </div>
                            </div>
                            
                            <div id="portfolio-alert"></div>
                        </div>
                    </div>
                    
                    <!-- Portfolio Visualization -->
                    <div class="col-md-8">
                        <div class="content-card">
                            <h4>üìä Market Regime Analysis</h4>
                            <p style="color: #6b7280; margin-bottom: 20px;">
                                W√§hle das aktuelle Marktregime aus, um die optimale Asset-Allokation zu ermitteln.
                            </p>
                            
                            <select id="regime-select" class="form-control mb-3" onchange="updateRegimeAnalysis()" style="margin-bottom: 30px;" title="Marktregime ausw√§hlen" aria-label="W√§hle das aktuelle Marktregime">
                                <option value="Goldilocks">üåü Goldilocks - Ideale Bedingungen</option>
                                <option value="Reflation">üöÄ Reflation - Wirtschaftswachstum</option>
                                <option value="Inflation">üî• Inflation - Steigende Preise</option>
                                <option value="Deflation">‚ùÑÔ∏è Deflation - Fallende Preise</option>
                            </select>
                            
                            <!-- Wichtiger Hinweis f√ºr Benutzer -->
                            <div style="background: linear-gradient(135deg, rgba(218, 165, 32, 0.15) 0%, rgba(184, 134, 11, 0.1) 100%); border: 2px solid #daa520; border-radius: 12px; padding: 20px; margin-bottom: 25px; position: relative; overflow: hidden;">
                                <div style="display: flex; align-items: flex-start; gap: 15px;">
                                    <span style="font-size: 2em; line-height: 1;">üí°</span>
                                    <div>
                                        <strong style="color: #b8860b; font-size: 1.1em; display: block; margin-bottom: 8px;">Wichtiger Hinweis</strong>
                                        <p style="color: #1a1a1a; margin: 0; font-size: 1.05em; line-height: 1.5;">
                                            Der Wert der Marktampel liegt in den <strong style="color: #b8860b;">Sektoren</strong>, die du weiter unten siehst. 
                                            Die Allokation hier ist ein <em>Beispiel-Startpunkt</em> zum Lernen der Grundprinzipien.
                                        </p>
                                    </div>
                                </div>
                                <div style="position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; background: rgba(218, 165, 32, 0.1); border-radius: 50%;"></div>
                            </div>
                            
                            <div id="portfolio-chart"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Sector Performance Table -->
                <div class="content-card">
                    <h4>üìä Sector Performance by Market Regime</h4>
                    <p style="color: #6b7280; margin-bottom: 30px;">
                        Kumulative Performance verschiedener Sektoren und ETFs nach Marktregimen. Die Tabelle zeigt nur die Werte f√ºr das ausgew√§hlte Regime.
                    </p>
                    
                    <div class="table-responsive">
                        <table class="table table-hover" id="sector-performance-table">
                            <thead>
                                <tr>
                                    <th style="background: linear-gradient(135deg, #1a1a1a 0%, #b8860b 100%); color: white; border: none; padding: 15px;">Symbol</th>
                                    <th style="background: linear-gradient(135deg, #1a1a1a 0%, #b8860b 100%); color: white; border: none; padding: 15px;">Sector</th>
                                    <th style="background: linear-gradient(135deg, #1a1a1a 0%, #b8860b 100%); color: white; border: none; padding: 15px;" id="regime-column-header">GOLDILOCKS</th>
                                </tr>
                            </thead>
                            <tbody id="sector-table-body">
                                <!-- Wird durch JavaScript gef√ºllt -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Regime Analysis -->
                <div class="content-card">
                    <h4 id="regime-title">üéØ Goldilocks Regime Analysis</h4>
                    <p style="color: #6b7280; margin-bottom: 30px;">
                        Diese Analyse zeigt dir, welche Asset-Klassen in dem gew√§hlten Marktregime bevorzugt, neutral oder gemieden werden sollten.
                    </p>
                    <div class="row" id="regime-indicators">
                        <!-- Wird durch JavaScript gef√ºllt -->
                    </div>
                </div>
            </div>

            <!-- Trading Tab -->
            <div id="trading-tab" class="tab-content">
                <div class="content-card">
                    <h2>üìà Live Trading Dashboard</h2>
                    <p style="color: #6b7280; font-size: 1.1em; margin-bottom: 30px;">
                        Professionelle Trading-Tools f√ºr die Marktanalyse und Portfolio-Verwaltung in Echtzeit.
                    </p>
                </div>
                
                <div class="alert alert-info">
                    <strong>üöß Entwicklungshinweis:</strong> Das Live Trading Module wird derzeit entwickelt und steht bald zur Verf√ºgung.
                </div>
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="content-card">
                            <h4>üìä Market Data</h4>
                            <div class="metric-card">
                                <strong>SPY:</strong> $415.20 <span style="color: #38a169; font-weight: 600;">(+1.2%)</span>
                            </div>
                            <div class="metric-card">
                                <strong>GOLD:</strong> $1,950 <span style="color: #e53e3e; font-weight: 600;">(-0.3%)</span>
                            </div>
                            <div class="metric-card">
                                <strong>BTC:</strong> $42,500 <span style="color: #38a169; font-weight: 600;">(+2.1%)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="content-card">
                            <h4>üéØ AVWAP Levels</h4>
                            <div class="form-group" style="margin-bottom: 20px;">
                                <label for="ticker" style="color: #1a1a1a; font-weight: 600; margin-bottom: 10px; display: block;">Symbol:</label>
                                <input type="text" id="ticker" class="form-control" value="SPY" placeholder="Symbol eingeben">
                            </div>
                            <div id="avwap-analysis" style="padding: 20px; background: rgba(218, 165, 32, 0.05); border-radius: 8px; border-left: 4px solid #daa520;">
                                <p style="margin-bottom: 10px;"><strong>AVWAP Analysis f√ºr</strong> <span id="ticker-display" style="color: #b8860b; font-weight: 700;">SPY</span></p>
                                <p style="color: #6b7280; margin: 0;"><em>Berechnung wird implementiert...</em></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="content-card">
                            <h4>üíº Portfolio</h4>
                            <div style="padding: 20px; background: rgba(218, 165, 32, 0.05); border-radius: 8px; border-left: 4px solid #daa520;">
                                <p style="margin-bottom: 15px;"><strong>Current Positions:</strong></p>
                                <p style="color: #6b7280; margin: 0;"><em>Portfolio-Daten werden geladen...</em></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Portfolio Management
let portfolioData = {
    cash: 0,
    sp500: 60,
    gold: 30,
    bitcoin: 10
};

// Sector Performance Data (% of Cumulative Performance by Market Regime)
const sectorPerformanceData = {
    "SPY": { sector: "S&P 500", goldilocks: 62, reflation: 43, inflation: 1, deflation: -6, riskOn: 105, riskOff: -5 },
    "XLC": { sector: "Communication Services", goldilocks: 219, reflation: 102, inflation: -165, deflation: -56, riskOn: 321, riskOff: -221 },
    "XLY": { sector: "Consumer Discretionary", goldilocks: 68, reflation: 39, inflation: -12, deflation: 4, riskOn: 108, riskOff: -8 },
    "XLP": { sector: "Consumer Staples", goldilocks: 45, reflation: 34, inflation: 16, deflation: 5, riskOn: 79, riskOff: 21 },
    "XLE": { sector: "Energy", goldilocks: 95, reflation: 44, inflation: 33, deflation: -72, riskOn: 139, riskOff: -39 },
    "XLF": { sector: "Financials", goldilocks: 89, reflation: 54, inflation: 4, deflation: -47, riskOn: 143, riskOff: -43 },
    "XLV": { sector: "Health Care", goldilocks: 36, reflation: 23, inflation: 19, deflation: 22, riskOn: 60, riskOff: 40 },
    "XLI": { sector: "Industrials", goldilocks: 68, reflation: 46, inflation: 3, deflation: -17, riskOn: 114, riskOff: -14 },
    "XLK": { sector: "Information Technology", goldilocks: 43, reflation: 42, inflation: -1, deflation: 16, riskOn: 85, riskOff: 15 },
    "XLB": { sector: "Materials", goldilocks: 99, reflation: 30, inflation: -2, deflation: -27, riskOn: 129, riskOff: -29 },
    "XLRE": { sector: "Real Estate", goldilocks: 110, reflation: 30, inflation: 25, deflation: -65, riskOn: 140, riskOff: -40 },
    "XLU": { sector: "Utilities", goldilocks: 58, reflation: 16, inflation: 37, deflation: -11, riskOn: 73, riskOff: 27 },
    "SPHD": { sector: "Dividend Compounders", goldilocks: 54, reflation: 30, inflation: 9, deflation: 7, riskOn: 84, riskOff: 16 },
    "IWF": { sector: "Growth", goldilocks: 60, reflation: 48, inflation: -7, deflation: -1, riskOn: 108, riskOff: -8 },
    "SPHB": { sector: "High Beta", goldilocks: 114, reflation: 29, inflation: -14, deflation: -30, riskOn: 143, riskOff: -43 },
    "IWB": { sector: "Large Caps", goldilocks: 42, reflation: 34, inflation: 25, deflation: -1, riskOn: 77, riskOff: 23 },
    "SPLV": { sector: "Low Beta", goldilocks: 66, reflation: 45, inflation: 0, deflation: -11, riskOn: 111, riskOff: -11 },
    "QQQ": { sector: "Mega Cap Growth", goldilocks: 47, reflation: 43, inflation: -1, deflation: 12, riskOn: 89, riskOff: 11 },
    "IWR": { sector: "Mid Caps", goldilocks: 78, reflation: 39, inflation: 3, deflation: -19, riskOn: 117, riskOff: -17 },
    "MTUM": { sector: "Momentum", goldilocks: 62, reflation: 34, inflation: 2, deflation: 3, riskOn: 95, riskOff: 5 },
    "QUAL": { sector: "Quality", goldilocks: 47, reflation: 42, inflation: -4, deflation: 15, riskOn: 89, riskOff: 11 },
    "IWM": { sector: "Small Caps", goldilocks: 102, reflation: 46, inflation: 2, deflation: -50, riskOn: 149, riskOff: -49 },
    "IWD": { sector: "Value", goldilocks: 86, reflation: 41, inflation: 10, deflation: -37, riskOn: 127, riskOff: -27 }
};

// Regime Data
const regimeData = {
    "Goldilocks": {
        "Asset-Typ": { status: "preferred", value: "Risk Assets" },
        "Beta": { status: "preferred", value: "High Beta" },
        "Style": { status: "preferred", value: "Growth" },
        "Regional": { status: "preferred", value: "US" },
        "Currencies": { status: "preferred", value: "Gold" }
    },
    "Inflation": {
        "Asset-Typ": { status: "avoid", value: "Risk Assets" },
        "Beta": { status: "avoid", value: "High Beta" },
        "Style": { status: "neutral", value: "Value" },
        "Regional": { status: "preferred", value: "US" },
        "Currencies": { status: "neutral", value: "US Dollar" }
    },
    "Reflation": {
        "Asset-Typ": { status: "preferred", value: "Risk Assets" },
        "Beta": { status: "preferred", value: "High Beta" },
        "Style": { status: "neutral", value: "Value" },
        "Regional": { status: "preferred", value: "Emerging Markets" },
        "Currencies": { status: "avoid", value: "US Dollar" }
    },
    "Deflation": {
        "Asset-Typ": { status: "avoid", value: "Risk Assets" },
        "Beta": { status: "avoid", value: "High Beta" },
        "Style": { status: "neutral", value: "Quality" },
        "Regional": { status: "preferred", value: "US" },
        "Currencies": { status: "preferred", value: "US Dollar" }
    }
};

// Empfohlene Portfolio-Allokation pro Regime
const regimeAllocations = {
    "Goldilocks": { cash: 0, sp500: 60, gold: 30, bitcoin: 10 },
    "Reflation": { cash: 5, sp500: 60, gold: 30, bitcoin: 5 },
    "Inflation": { cash: 30, sp500: 30, gold: 35, bitcoin: 5 },
    "Deflation": { cash: 55, sp500: 15, gold: 30, bitcoin: 0 }
};

function showTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById(tabName + '-tab').classList.add('active');
    event.target.classList.add('active');
}

function updatePortfolio() {
    // Get current values
    portfolioData.cash = parseInt(document.getElementById('cash').value);
    portfolioData.sp500 = parseInt(document.getElementById('sp500').value);
    portfolioData.gold = parseInt(document.getElementById('gold').value);
    portfolioData.bitcoin = parseInt(document.getElementById('bitcoin').value);
    
    // Update display values
    document.getElementById('cash-value').textContent = portfolioData.cash + '%';
    document.getElementById('sp500-value').textContent = portfolioData.sp500 + '%';
    document.getElementById('gold-value').textContent = portfolioData.gold + '%';
    document.getElementById('bitcoin-value').textContent = portfolioData.bitcoin + '%';
    
    // Check total
    const total = portfolioData.cash + portfolioData.sp500 + portfolioData.gold + portfolioData.bitcoin;
    const alertDiv = document.getElementById('portfolio-alert');
    
    if (total !== 100) {
        alertDiv.innerHTML = `<div class="alert alert-error">Total must equal 100%. Current: ${total}%</div>`;
    } else {
        alertDiv.innerHTML = `<div class="alert alert-success">‚úÖ Portfolio balanced!</div>`;
        updateChart();
    }
}

function updateChart() {
    const data = [{
        values: [portfolioData.cash, portfolioData.sp500, portfolioData.gold, portfolioData.bitcoin],
        labels: ['Cash', 'S&P 500', 'Gold', 'Bitcoin'],
        type: 'pie',
        marker: {
            colors: ['#94a3b8', '#10b981', '#f59e0b', '#f97316']
        },
        textinfo: 'label+percent',
        textposition: 'outside'
    }];
    
    const layout = {
        title: 'Portfolio Allocation',
        font: { size: 16 },
        showlegend: true,
        legend: {
            orientation: "v",
            x: 1,
            y: 1
        }
    };
    
    Plotly.newPlot('portfolio-chart', data, layout, {responsive: true});
}

function updateRegimeAnalysis() {
    const selectedRegime = document.getElementById('regime-select').value;
    const regimeTitle = document.getElementById('regime-title');
    const regimeIndicators = document.getElementById('regime-indicators');
    
    regimeTitle.textContent = `üéØ ${selectedRegime} Regime Analysis`;
    
    const currentRegime = regimeData[selectedRegime] || regimeData["Goldilocks"];
    
    let html = '';
    Object.entries(currentRegime).forEach(([category, data]) => {
        const statusClass = `regime-${data.status}`;
        html += `
            <div class="col-md-2">
                <div class="regime-card ${statusClass}">
                    <strong>${category}</strong><br>
                    ${data.value}
                </div>
            </div>
        `;
    });
    
    regimeIndicators.innerHTML = html;
    
    // Update portfolio allocation based on regime
    updatePortfolioForRegime(selectedRegime);
    
    // Update sector performance table
    updateSectorTable(selectedRegime);
}

function updatePortfolioForRegime(regime) {
    const allocation = regimeAllocations[regime] || regimeAllocations["Goldilocks"];
    
    // Update slider values
    document.getElementById('cash').value = allocation.cash;
    document.getElementById('sp500').value = allocation.sp500;
    document.getElementById('gold').value = allocation.gold;
    document.getElementById('bitcoin').value = allocation.bitcoin;
    
    // Update portfolio data
    portfolioData.cash = allocation.cash;
    portfolioData.sp500 = allocation.sp500;
    portfolioData.gold = allocation.gold;
    portfolioData.bitcoin = allocation.bitcoin;
    
    // Update display values
    document.getElementById('cash-value').textContent = allocation.cash + '%';
    document.getElementById('sp500-value').textContent = allocation.sp500 + '%';
    document.getElementById('gold-value').textContent = allocation.gold + '%';
    document.getElementById('bitcoin-value').textContent = allocation.bitcoin + '%';
    
    // Update alert and chart
    const alertDiv = document.getElementById('portfolio-alert');
    alertDiv.innerHTML = `<div class="alert alert-success">‚úÖ Empfohlene ${regime}-Allokation geladen!</div>`;
    
    updateChart();
}

function updateSectorTable(selectedRegime) {
    const tableBody = document.getElementById('sector-table-body');
    const columnHeader = document.getElementById('regime-column-header');
    
    // Update column header
    columnHeader.textContent = selectedRegime.toUpperCase();
    
    // Get the regime key for data access
    const regimeKey = selectedRegime.toLowerCase();
    
    // Sort sectors by performance for selected regime
    const sortedSectors = Object.entries(sectorPerformanceData).sort((a, b) => {
        const aValue = a[1][regimeKey] || 0;
        const bValue = b[1][regimeKey] || 0;
        return bValue - aValue; // Sort descending
    });
    
    let html = '';
    sortedSectors.forEach(([symbol, data]) => {
        const performanceValue = data[regimeKey] || 0;
        let performanceClass = 'performance-neutral';
        
        if (performanceValue > 10) {
            performanceClass = 'performance-positive';
        } else if (performanceValue < -10) {
            performanceClass = 'performance-negative';
        }
        
        const formattedValue = performanceValue > 0 ? `+${performanceValue}%` : `${performanceValue}%`;
        
        html += `
            <tr>
                <td><span class="sector-symbol">${symbol}</span></td>
                <td>${data.sector}</td>
                <td class="${performanceClass}">${formattedValue}</td>
            </tr>
        `;
    });
    
    tableBody.innerHTML = html;
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    updatePortfolio();
    updateRegimeAnalysis();
    // Initialize sector table with default regime
    updateSectorTable('Goldilocks');
});
</script>

<!-- Einheitliche Navigation -->
{% include '_navigation.html' %}

{% endblock %}
