<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Lerne das Kelly-Kriterium f√ºr optimales Risikomanagement im Trading. Interaktiver Rechner und Simulator inklusive.">
    <meta name="keywords" content="Kelly-Kriterium, Risikomanagement, Trading, Position Sizing, Money Management">
    
    <title>Kelly-Kriterium - Position Sizing | Didis Trading Academy</title>
    
    <!-- Import Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Chart.js mit verbessertem Fallback -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js" 
            onload="console.log('Chart.js erfolgreich geladen')" 
            onerror="loadChartJsFallback()"></script>
    <script>
        let chartJsLoaded = false;
        
        // Pr√ºfe ob Chart.js geladen wurde
        function checkChartJs() {
            if (typeof Chart !== 'undefined') {
                chartJsLoaded = true;
                console.log('Chart.js ist verf√ºgbar');
                return true;
            }
            return false;
        }
        
        // Fallback-Funktion
        function loadChartJsFallback() {
            console.warn('Prim√§res Chart.js CDN fehlgeschlagen, lade Fallback...');
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js';
            script.onload = function() {
                chartJsLoaded = true;
                console.log('Chart.js Fallback erfolgreich geladen');
            };
            script.onerror = function() {
                console.error('Auch Chart.js Fallback konnte nicht geladen werden');
            };
            document.head.appendChild(script);
        }
        
        // Warte auf Chart.js
        function waitForChart(callback, maxAttempts = 10) {
            let attempts = 0;
            const interval = setInterval(() => {
                attempts++;
                if (checkChartJs()) {
                    clearInterval(interval);
                    callback();
                } else if (attempts >= maxAttempts) {
                    clearInterval(interval);
                    console.error('Chart.js konnte nach', maxAttempts, 'Versuchen nicht geladen werden');
                }
            }, 500);
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: #f7f7f7;
            line-height: 1.6;
            font-size: 1.05em;
            min-height: 100vh;
        }
        
        .container-fluid {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Hero Header mit Prim√§r-Verlauf */
        .main-header {
            background: linear-gradient(135deg, #1a1a1a 0%, #b8860b 100%);
            padding: 40px;
            border-radius: 12px;
            color: white;
            text-align: center;
            margin-bottom: 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .main-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(218, 165, 32, 0.1) 0%, rgba(184, 134, 11, 0.1) 100%);
            pointer-events: none;
        }
        
        .main-header h1 {
            font-size: 2.8em;
            font-weight: 800;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }
        
        .main-header p {
            font-size: 1.2em;
            opacity: 0.9;
            font-weight: 400;
            position: relative;
            z-index: 1;
        }

        /* Fortschritts-Tracking mit Gold-Verlauf */
        .progress-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #daa520;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }
        
        .progress-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            border-left-color: #b8860b;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #b8860b, #daa520);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        /* Aufklappbare Sektionen mit Premium-Design */
        .section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 30px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .section.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .section-header {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
            padding: 20px 30px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .section-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(218, 165, 32, 0.2), transparent);
            transition: right 0.6s ease;
        }
        
        .section-header:hover::before {
            right: 100%;
        }
        
        .section-header:hover {
            background: linear-gradient(135deg, #1a1a1a 0%, #b8860b 100%);
            transform: translateY(-1px);
        }
        
        .section-header h2 {
            font-size: 1.4em;
            margin: 0;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }
        
        .section-toggle {
            font-size: 1.5rem;
            transition: transform 0.3s ease;
            color: #daa520;
            position: relative;
            z-index: 1;
        }
        
        .section.expanded .section-toggle {
            transform: rotate(180deg);
        }
        
        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }
        
        .section.expanded .section-content {
            max-height: 5000px;
        }
        
        .content-inner {
            padding: 40px;
            font-size: 1.05em;
            line-height: 1.6;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold-dark), var(--gold-classic));
            width: 0%;
            transition: width 0.5s ease;
        }


        /* Highlight-Boxen mit Premium-Design */
        .analogy-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%);
            border-left: 4px solid #b8860b;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .analogy-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            border-left-color: #daa520;
        }

        .analogy-box::before {
            content: "üí°";
            font-size: 2rem;
            position: absolute;
            top: -15px;
            left: 20px;
            background: white;
            padding: 0 10px;
        }

        .analogy-box h3 {
            color: var(--warning);
            margin-bottom: 10px;
            margin-top: 10px;
        }

        .success-box {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-left: 4px solid #38a169;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .success-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            border-left-color: #2f855a;
        }

        .success-box h3 {
            color: var(--success);
            margin-bottom: 10px;
        }

        /* Warnboxen: Orange/Rot Hintergrundverlauf mit farbigem linkem Rand */
        .danger-box {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            border-left: 4px solid var(--error);
            border-radius: 12px; /* Einheitlicher Border-Radius */
            padding: 20px; /* Standard-Padding */
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); /* Subtiler Schatten */
        }

        .danger-box h3 {
            color: var(--error);
            margin-bottom: 10px;
        }

        .example-box {
            background: #f0f9ff;
            border-left: 4px solid var(--info-blue);
            padding: 20px; /* Standard-Padding */
            margin: 20px 0;
            border-radius: 12px; /* Einheitlicher Border-Radius */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); /* Subtiler Schatten */
        }

        .example-box h4 {
            color: var(--info-blue);
            margin-bottom: 10px;
        }

        /* Kelly Simulator Styles */
        /* Interaktive Karten: Hover-Effekte mit Bewegung nach oben */
        .simulator-container {
            background: var(--bg-card);
            border-left: 4px solid var(--info-blue);
            border-radius: 12px; /* Einheitlicher Border-Radius */
            padding: 40px; /* Gr√∂√üere Bereiche aus Design-System */
            margin: 30px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); /* Subtiler Schatten */
            transition: all 0.3s ease; /* Sanfte √úberg√§nge */
        }

        .simulator-container:hover {
            transform: translateY(-2px); /* Hover-Effekte mit Bewegung nach oben */
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
        }

        .simulator-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .simulator-header h3 {
            color: var(--primary-dark);
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .simulator-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 30px;
        }

        .slider-group {
            display: flex;
            flex-direction: column;
        }

        .slider-label {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
        }

        .slider-value {
            color: var(--gold-classic); /* Gold-Akzent aus Design-System */
            font-size: 1.1rem;
            font-weight: bold;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e5e7eb;
            outline: none;
            -webkit-appearance: none;
            margin: 15px 0;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--gold-dark), var(--gold-classic)); /* Gold-Verlauf */
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: all 0.3s ease; /* Sanfte √úberg√§nge */
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--gold-dark), var(--gold-classic)); /* Gold-Verlauf */
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: all 0.3s ease; /* Sanfte √úberg√§nge */
        }

        .kelly-result {
            background: var(--bg-card);
            border-left: 4px solid var(--gold-classic); /* Gold-Akzent linker Rand */
            border-radius: 12px; /* Einheitlicher Border-Radius */
            padding: 40px; /* Gr√∂√üere Bereiche aus Design-System */
            text-align: center;
            margin: 30px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); /* Subtiler Schatten */
        }

        .kelly-result h4 {
            color: var(--primary-dark);
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .kelly-percentage {
            font-size: 3.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, var(--gold-dark), var(--gold-classic)); /* Gold-Verlauf f√ºr Text */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 15px 0;
        }

        .kelly-description {
            color: #6b7280;
            font-size: 1rem;
        }

        .chart-container {
            background: var(--bg-card);
            border-radius: 12px; /* Einheitlicher Border-Radius */
            padding: 40px; /* Gr√∂√üere Bereiche aus Design-System */
            margin-top: 30px;
            position: relative;
            min-height: 450px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); /* Subtiler Schatten */
        }

        .chart-title {
            text-align: center;
            color: var(--primary-dark);
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #374151;
        }

        .legend-color {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }

        .legend-color.half-kelly {
            background: #10b981;
        }

        .legend-color.full-kelly {
            background: #3b82f6;
        }

        .legend-color.overbetting {
            background: #ef4444;
            border: 2px dashed #ef4444;
            height: 1px;
        }

        .simulation-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }

        .stat-card {
            background: var(--bg-card);
            border-left: 4px solid var(--gold-light); /* Gold-Akzent linker Rand */
            border-radius: 12px; /* Einheitlicher Border-Radius */
            padding: 20px; /* Standard-Padding */
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); /* Subtiler Schatten */
            transition: all 0.3s ease; /* Sanfte √úberg√§nge */
        }

        .stat-card:hover {
            transform: translateY(-2px); /* Hover-Effekte mit Bewegung nach oben */
            border-left-color: var(--gold-classic); /* Rahmen-Farbwechsel zu Gold */
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
        }

        .stat-label {
            font-size: 0.85rem;
            color: #6b7280;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .stat-value.positive {
            color: var(--success);
        }

        .stat-value.negative {
            color: var(--error);
        }

        .stat-value.neutral {
            color: var(--primary-dark);
        }

        /* Mobile Responsivit√§t: Breakpoint bei 768px aus Design-System */
        @media (max-width: 768px) {
            .container {
                padding: 20px; /* Standard-Padding auch auf Mobile */
            }
            
            .header h1 {
                font-size: 2.2rem; /* Angepasste Schriftgr√∂√üen */
            }
            
            .simulator-controls {
                grid-template-columns: 1fr; /* Stapelbare Grid-Layouts */
                gap: 25px;
            }
            
            .section-header {
                padding: 20px; /* Standard-Padding */
            }
            
            .content-inner {
                padding: 20px; /* Standard-Padding auf Mobile */
            }
            
            .simulator-container {
                padding: 20px; /* Angepasste Abst√§nde */
            }
            
            .kelly-result {
                padding: 20px; /* Angepasste Abst√§nde */
            }
            
            .chart-container {
                padding: 20px; /* Angepasste Abst√§nde */
            }

            .legend {
                gap: 15px;
            }

            .simulation-stats {
                grid-template-columns: 1fr;
            }

            .kelly-percentage {
                font-size: 2.5rem;
            }
        }
    </style>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="header">
            <h1>üéØ Das Kelly-Kriterium</h1>
            <p>Wie viel Geld solltest du bei einem Trade riskieren? Die Mathematik hat eine Antwort!</p>
        </div>

        <div class="progress-container">
            <h3>üìö Dein Lernfortschritt</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="progressText">0% abgeschlossen</p>
        </div>

        <!-- Abschnitt 1: Was ist das Kelly-Kriterium? -->
        <div class="section" data-section="1">
            <div class="section-header" onclick="toggleSection(1)">
                <h2>ü§î Was ist das Kelly-Kriterium?</h2>
                <span class="section-toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <div class="content-inner">
                    <p><strong>Stell dir vor, du bist auf dem Schulhof und spielst ein Spiel:</strong></p>
                    
                    <div class="analogy-box">
                        <h3>üé≤ Das Schulhof-Spiel</h3>
                        <p>Du hast 10‚Ç¨ Taschengeld und dein Freund bietet dir ein Spiel an:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Er wirft eine M√ºnze</li>
                            <li>Bei Kopf: Du gewinnst das Doppelte deines Einsatzes</li>
                            <li>Bei Zahl: Du verlierst deinen Einsatz</li>
                            <li>Die M√ºnze ist manipuliert und zeigt √∂fter Kopf (60% der Zeit)</li>
                        </ul>
                        <p><strong>Die gro√üe Frage:</strong> Wie viel von deinen 10‚Ç¨ solltest du setzen?</p>
                    </div>

                    <p>Genau diese Frage beantwortet das Kelly-Kriterium! Es ist eine mathematische Formel, die dir sagt:</p>
                    
                    <div class="success-box">
                        <h3>‚úÖ Was das Kelly-Kriterium macht:</h3>
                        <ul style="margin-left: 20px;">
                            <li><strong>Berechnet die optimale Einsatzgr√∂√üe</strong> f√ºr jede Wette</li>
                            <li><strong>Maximiert dein Geld langfristig</strong> - nicht nur einen Trade</li>
                            <li><strong>Ber√ºcksichtigt deine Gewinnchancen</strong> und wie viel du gewinnen kannst</li>
                            <li><strong>Sch√ºtzt dich vor dem Totalverlust</strong> durch zu hohe Eins√§tze</li>
                        </ul>
                    </div>

                    <div class="example-box">
                        <h4>üßÆ Einfaches Beispiel:</h4>
                        <p>Bei unserem M√ºnzspiel w√ºrde Kelly sagen: <strong>"Setze 20% deines Geldes"</strong></p>
                        <p>Das bedeutet: Von deinen 10‚Ç¨ setzt du 2‚Ç¨. Egal ob du gewinnst oder verlierst, beim n√§chsten Spiel setzt du wieder 20% von dem, was du dann hast.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Abschnitt 2: Die Kelly-Formel verstehen -->
        <div class="section" data-section="2">
            <div class="section-header" onclick="toggleSection(2)">
                <h2>üßÆ Die Kelly-Formel verstehen</h2>
                <span class="section-toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <div class="content-inner">
                    <p>Keine Angst vor Mathe! Wir erkl√§ren die Formel so einfach wie ein Kochrezept.</p>

                    <div style="background: linear-gradient(135deg, #dbeafe, #bfdbfe); border: 2px solid var(--info-blue); border-radius: 12px; padding: 25px; margin: 25px 0; text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--info-blue); margin-bottom: 15px; font-family: 'Courier New', monospace;">
                            Kelly % = Gewinnrate - (1-Gewinnrate) √∑ Gewinn-Verlust-Verh√§ltnis
                        </div>
                    </div>

                    <div class="analogy-box">
                        <h3>üçï Die Pizza-Analogie</h3>
                        <p>Stell dir vor, du teilst eine Pizza zwischen deinen Freunden auf:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Gewinnrate:</strong> Wie oft bekommst du ein gr√∂√üeres St√ºck? (z.B. 6 von 10 Mal = 60%)</li>
                            <li><strong>Gewinn-Verlust-Verh√§ltnis:</strong> Wenn du gewinnst, wie viel gr√∂√üer ist dein St√ºck im Vergleich zu dem, was du aufgibst?</li>
                            <li><strong>Kelly-Ergebnis:</strong> Wie stark solltest du beim n√§chsten Pizza-Tausch "dr√§ngeln"?</li>
                        </ul>
                    </div>

                    <div class="example-box">
                        <h4>üí° Schritt-f√ºr-Schritt Beispiel:</h4>
                        <p><strong>Situation:</strong> Du hast 10 Trades gemacht:</p>
                        <ul style="margin: 10px 0 10px 20px;">
                            <li>6 Trades gewonnen, 4 verloren</li>
                            <li>Bei Gewinnen: durchschnittlich +200‚Ç¨</li>
                            <li>Bei Verlusten: durchschnittlich -100‚Ç¨</li>
                        </ul>
                        
                        <p><strong>Berechnung:</strong></p>
                        <ul style="margin: 10px 0 10px 20px;">
                            <li>Gewinnrate = 6√∑10 = 0,6 (60%)</li>
                            <li>Gewinn-Verlust-Verh√§ltnis = 200‚Ç¨√∑100‚Ç¨ = 2</li>
                            <li>Kelly % = 0,6 - (1-0,6)√∑2 = 0,6 - 0,4√∑2 = 0,6 - 0,2 = 0,4 = <strong>40%</strong></li>
                        </ul>
                        
                        <p><strong>Bedeutung:</strong> Die Formel schl√§gt vor, maximal 40% deines Kapitals bei einem Trade zu riskieren.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Abschnitt 3: Warum "Full Kelly" gef√§hrlich ist - MIT SIMULATOR -->
        <div class="section" data-section="3">
            <div class="section-header" onclick="toggleSection(3)">
                <h2>‚ö†Ô∏è Warum "Full Kelly" gef√§hrlich ist</h2>
                <span class="section-toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <div class="content-inner">
                    <p>Die Kelly-Formel ist mathematisch perfekt - aber die Realit√§t ist es nicht!</p>

                    <div class="danger-box">
                        <h3>üö® Das Problem mit "Full Kelly"</h3>
                        <p><strong>"Full Kelly"</strong> bedeutet, dass du genau den Prozentsatz verwendest, den die Formel ausspuckt. Das klingt logisch, aber ist in der Praxis sehr gef√§hrlich!</p>
                    </div>

                    <!-- KELLY SIMULATOR -->
                    <div class="simulator-container">
                        <div class="simulator-header">
                            <h3>Interaktiver Rechner & Simulation</h3>
                            <p>Passen Sie die Gewinnwahrscheinlichkeit (W) und das Chance-Risiko-Verh√§ltnis (R) an, um den optimalen Kelly-Prozentsatz zu berechnen. Die untenstehende Simulation visualisiert, wie sich Ihr Kapital √ºber eine Reihe von Trades unter verschiedenen Strategien entwickeln k√∂nnte, basierend auf Ihren Eingaben.</p>
                        </div>

                        <div class="simulator-controls">
                            <div class="slider-group">
                                <div class="slider-label">
                                    <span>Gewinnwahrscheinlichkeit (W):</span>
                                    <span class="slider-value" id="winProbValue">60%</span>
                                </div>
                                <input type="range" class="slider" id="winProbSlider" 
                                       min="10" max="90" value="60" step="5">
                            </div>

                            <div class="slider-group">
                                <div class="slider-label">
                                    <span>Chance-Risiko-Verh√§ltnis (R):</span>
                                    <span class="slider-value" id="riskRewardValue">2.00</span>
                                </div>
                                <input type="range" class="slider" id="riskRewardSlider" 
                                       min="1.1" max="5.0" value="2.0" step="0.1">
                            </div>
                        </div>

                        <div class="kelly-result">
                            <h4>Optimaler Kelly-Einsatz (K%)</h4>
                            <div class="kelly-percentage" id="kellyPercentage">20.00%</div>
                            <p class="kelly-description">Optimalerweise sollten Sie <span id="kellyText">20.00%</span> Ihres Kapitals pro Trade riskieren.</p>
                        </div>

                        <div class="chart-container">
                            <h4 class="chart-title">Kapitalentwicklung √ºber 100 simulierte Trades</h4>
                            <div class="legend">
                                <div class="legend-item">
                                    <div class="legend-color half-kelly"></div>
                                    <span>Half Kelly (K * 0.5)</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color full-kelly"></div>
                                    <span>Full Kelly (K * 1.0)</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color overbetting"></div>
                                    <span>Overbetting (K * 1.5)</span>
                                </div>
                            </div>
                            <canvas id="simulationChart" width="800" height="300"></canvas>
                        </div>

                        <div class="simulation-stats" id="simulationStats">
                            <!-- Stats werden dynamisch generiert -->
                        </div>
                    </div>

                    <div class="example-box">
                        <h4>üí∏ Was du im Simulator siehst:</h4>
                        <p><strong>Beobachte die Unterschiede:</strong></p>
                        <ul style="margin: 10px 0 10px 20px;">
                            <li><strong>Half Kelly (gr√ºne Linie):</strong> Sanfte, stetige Entwicklung nach oben</li>
                            <li><strong>Full Kelly (blaue Linie):</strong> Viel volatiler, extremere Schwankungen</li>
                            <li><strong>Overbetting (rote Linie):</strong> Wie eine wilde Achterbahn - oft Totalverlust!</li>
                        </ul>
                        <p><strong>√Ñndere die Parameter und sieh, was passiert:</strong> Auch bei guten Gewinnraten kann Full Kelly zu dramatischen Verlusten f√ºhren!</p>
                    </div>

                    <div class="danger-box">
                        <h3>‚ö° Die Realit√§t des Marktes</h3>
                        <p>M√§rkte sind nicht wie M√ºnzw√ºrfe. Sie k√∂nnen:</p>
                        <ul style="margin-left: 20px;">
                            <li>Pl√∂tzlich ihr Verhalten √§ndern</li>
                            <li>Wochen oder Monate in eine Richtung laufen</li>
                            <li>Von externen Schocks getroffen werden</li>
                            <li>Deine besten Strategien pl√∂tzlich nicht mehr funktionieren lassen</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Abschnitt 4: Die sichere Alternative -->
        <div class="section" data-section="4">
            <div class="section-header" onclick="toggleSection(4)">
                <h2>üõ°Ô∏è Die sichere Alternative: Halbes Kelly</h2>
                <span class="section-toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <div class="content-inner">
                    <p>Die L√∂sung: Nutze nur einen <strong>Bruchteil</strong> von dem, was Kelly vorschl√§gt!</p>

                    <div class="success-box">
                        <h3>‚úÖ Die "Fraktionierte Kelly-Strategie"</h3>
                        <p>Anstatt 100% des Kelly-Ergebnisses zu verwenden, nimmst du nur:</p>
                        <ul style="margin-left: 20px;">
                            <li><strong>50% = "Half Kelly"</strong> (beliebteste Variante)</li>
                            <li><strong>25% = "Quarter Kelly"</strong> (sehr konservativ)</li>
                            <li><strong>10% = "Ultra-Safe Kelly"</strong> (f√ºr Anf√§nger)</li>
                        </ul>
                    </div>

                    <div class="analogy-box">
                        <h3>üöó Die Autobahn-Analogie</h3>
                        <p>Kelly ist wie ein Geschwindigkeitsmesser:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Full Kelly:</strong> Rast mit 200 km/h auf der Autobahn</li>
                            <li><strong>Half Kelly:</strong> F√§hrst entspannte 100 km/h</li>
                            <li><strong>Ergebnis:</strong> Du kommst nur etwas sp√§ter an, aber viel sicherer!</li>
                        </ul>
                    </div>

                    <div class="success-box">
                        <h3>üèÜ Warum Half Kelly so beliebt ist:</h3>
                        <ul style="margin-left: 20px;">
                            <li><strong>75% der potenziellen Rendite</strong> - aber nur 50% des Risikos</li>
                            <li><strong>Viel glattere Kapitalentwicklung</strong> - weniger Achterbahn</li>
                            <li><strong>Schutz vor Sch√§tzfehlern</strong> - doppelte Sicherheitsmarge</li>
                            <li><strong>Besserer Schlaf</strong> - weniger Stress, bessere Entscheidungen</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Zusammenfassung -->
        <div class="section" data-section="5">
            <div class="section-header" onclick="toggleSection(5)">
                <h2>üéì Zusammenfassung & n√§chste Schritte</h2>
                <span class="section-toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <div class="content-inner">
                    <div class="success-box">
                        <h3>üèÜ Herzlichen Gl√ºckwunsch! Du hast das Kelly-Kriterium gemeistert!</h3>
                        <p>Du wei√üt jetzt mehr √ºber Risikomanagement als 95% aller Trader. Das ist dein entscheidender Vorteil!</p>
                    </div>

                    <h3>üìã Die wichtigsten Erkenntnisse:</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
                        <div style="background: #dbeafe; padding: 20px; border-radius: 8px;">
                            <h4>üéØ Kelly ist ein Werkzeug</h4>
                            <p>Es berechnet die theoretische Obergrenze f√ºr dein Risiko - nicht den Betrag, den du setzen MUSST.</p>
                        </div>
                        
                        <div style="background: #fee2e2; padding: 20px; border-radius: 8px;">
                            <h4>‚ö†Ô∏è Full Kelly ist gef√§hrlich</h4>
                            <p>100% der Kelly-Empfehlung f√ºhrt zu extremen Schwankungen, die psychisch nicht durchhaltbar sind.</p>
                        </div>
                        
                        <div style="background: #d1fae5; padding: 20px; border-radius: 8px;">
                            <h4>üõ°Ô∏è Sicherheit geht vor</h4>
                            <p>Half Kelly oder Quarter Kelly bietet fast die gleiche Rendite bei viel weniger Risiko und Stress.</p>
                        </div>
                        
                        <div style="background: #fef3c7; padding: 20px; border-radius: 8px;">
                            <h4>üìä Daten sind alles</h4>
                            <p>Ohne ehrliche Dokumentation deiner Trades kannst du Kelly nicht sinnvoll anwenden.</p>
                        </div>
                    </div>

                    <div class="success-box">
                        <h3>üöÄ Deine n√§chsten Schritte:</h3>
                        <ol style="margin-left: 20px;">
                            <li><strong>Trading-Tagebuch starten:</strong> Dokumentiere ab heute jeden Trade penibel</li>
                            <li><strong>Conservative starten:</strong> Beginne mit 10% Kelly bis du Erfahrung hast</li>
                            <li><strong>Regelm√§√üig √ºberpr√ºfen:</strong> Alle 3 Monate neue Berechnung</li>
                            <li><strong>Disziplin bewahren:</strong> Niemals √ºber deine Kelly-Grenze hinaus!</li>
                        </ol>
                    </div>

                    <div style="text-align: center; margin: 40px 0; padding: 30px; background: linear-gradient(135deg, var(--primary-dark), var(--primary-medium)); color: white; border-radius: 12px;">
                        <h3>üíé Willst du noch mehr lernen?</h3>
                        <p>Das Kelly-Kriterium ist nur der Anfang. In Didis Premium Trading Club lernst du:</p>
                        <ul style="text-align: left; max-width: 500px; margin: 20px auto;">
                            <li>Magic Line Strategie f√ºr perfekte Ein- und Ausstiege</li>
                            <li>Portfolio-Management mit mehreren Positionen</li>
                            <li>Psychologie des Tradings und Mindset-Training</li>
                            <li>Live-Analysen und Trade-Setups in Echtzeit</li>
                        </ul>
                        
                        <div style="margin-top: 30px;">
                            <a href="https://didis-charts.com/produkt/premium-newsletter-jahresabo/" 
                               target="_blank"
                               style="background: var(--gold-classic); color: var(--primary-dark); padding: 15px 30px; border-radius: 8px; text-decoration: none; font-weight: 600; margin: 10px; display: inline-block;">
                                üöÄ Premium Trading Club
                            </a>
                            <a href="https://didis-charts.com/produkt/trading-club-langfristdepot/" 
                               target="_blank"
                               style="background: var(--gold-classic); color: var(--primary-dark); padding: 15px 30px; border-radius: 8px; text-decoration: none; font-weight: 600; margin: 10px; display: inline-block;">
                                üè¢ Langfrist-Depot VIP
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Globale Variablen
        let currentSection = 0;
        let simulationChart = null;

        // Initialisierung
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            toggleSection(1); // Erstes Section automatisch √∂ffnen
            
            // Warte auf Chart.js bevor Simulator initialisiert wird
            waitForChart(function() {
                console.log('Chart.js verf√ºgbar - initialisiere Simulator');
                initializeSimulator();
            });
            
            // Fallback nach 10 Sekunden
            setTimeout(function() {
                if (!checkChartJs()) {
                    console.error('Chart.js konnte nicht geladen werden. Simulator deaktiviert.');
                    // Zeige Fehlermeldung im Simulator-Container
                    const simulatorContainer = document.querySelector('.simulator-container');
                    if (simulatorContainer) {
                        simulatorContainer.innerHTML = `
                            <div style="text-align: center; padding: 40px; background: #fee2e2; border-radius: 12px; border-left: 4px solid #dc2626;">
                                <h3 style="color: #dc2626; margin-bottom: 15px;">‚ö†Ô∏è Simulator nicht verf√ºgbar</h3>
                                <p>Chart.js konnte nicht geladen werden. Bitte pr√ºfen Sie Ihre Internetverbindung oder laden Sie die Seite neu.</p>
                                <button onclick="location.reload()" style="margin-top: 15px; padding: 10px 20px; background: #dc2626; color: white; border: none; border-radius: 8px; cursor: pointer;">
                                    Seite neu laden
                                </button>
                            </div>
                        `;
                    }
                }
            }, 10000);
        });

        // Section Toggle
        function toggleSection(sectionNumber) {
            const section = document.querySelector(`.section[data-section="${sectionNumber}"]`);
            const isExpanded = section.classList.contains('expanded');
            
            // Alle anderen Sections schlie√üen
            document.querySelectorAll('.section').forEach(s => {
                s.classList.remove('expanded');
            });
            
            // Current section togglen
            if (!isExpanded) {
                section.classList.add('expanded', 'visible');
                currentSection = sectionNumber;
                updateProgress();
            }
        }

        // Progress Update
        function updateProgress() {
            const totalSections = 5;
            const progressPercent = (currentSection / totalSections) * 100;
            document.getElementById('progressFill').style.width = progressPercent + '%';
            document.getElementById('progressText').textContent = Math.round(progressPercent) + '% abgeschlossen';
        }

        // Kelly Simulator Functions
        function initializeSimulator() {
            const winProbSlider = document.getElementById('winProbSlider');
            const riskRewardSlider = document.getElementById('riskRewardSlider');

            winProbSlider.addEventListener('input', updateSimulation);
            riskRewardSlider.addEventListener('input', updateSimulation);

            updateSimulation();
        }

        function updateSimulation() {
            const winProb = parseFloat(document.getElementById('winProbSlider').value) / 100;
            const riskReward = parseFloat(document.getElementById('riskRewardSlider').value);

            // Update display values
            document.getElementById('winProbValue').textContent = (winProb * 100).toFixed(0) + '%';
            document.getElementById('riskRewardValue').textContent = riskReward.toFixed(2);

            // Calculate Kelly
            const kelly = winProb - (1 - winProb) / riskReward;
            const kellyPercent = Math.max(0, kelly * 100);

            document.getElementById('kellyPercentage').textContent = kellyPercent.toFixed(2) + '%';
            document.getElementById('kellyText').textContent = kellyPercent.toFixed(2) + '%';

            // Run simulation
            runSimulation(winProb, riskReward, kelly);
        }

        function runSimulation(winProb, riskReward, kelly) {
            const startingCapital = 10000;
            const numTrades = 100;
            
            // Generate random trades
            const trades = [];
            for (let i = 0; i < numTrades; i++) {
                const isWin = Math.random() < winProb;
                const return_ = isWin ? riskReward : -1;
                trades.push(return_);
            }

            // Simulate different strategies
            const strategies = [
                { name: 'Half Kelly', fraction: 0.5, color: '#10b981' },
                { name: 'Full Kelly', fraction: 1.0, color: '#3b82f6' },
                { name: 'Overbetting', fraction: 1.5, color: '#ef4444' }
            ];

            const results = strategies.map(strategy => {
                let capital = startingCapital;
                const capitalHistory = [capital];
                let maxDrawdown = 0;
                let peak = capital;

                for (const tradeReturn of trades) {
                    const fraction = Math.max(0, kelly * strategy.fraction);
                    const betAmount = capital * fraction;
                    const profit = betAmount * tradeReturn;
                    capital += profit;
                    
                    if (capital <= 0) capital = 1; // Prevent total loss
                    
                    capitalHistory.push(capital);
                    
                    // Track drawdown
                    if (capital > peak) peak = capital;
                    const drawdown = (peak - capital) / peak;
                    if (drawdown > maxDrawdown) maxDrawdown = drawdown;
                }

                return {
                    name: strategy.name,
                    color: strategy.color,
                    capitalHistory: capitalHistory,
                    finalCapital: capital,
                    totalReturn: ((capital - startingCapital) / startingCapital * 100),
                    maxDrawdown: maxDrawdown * 100,
                    volatility: calculateVolatility(capitalHistory)
                };
            });

            updateChart(results);
            updateStats(results);
        }

        function calculateVolatility(capitalHistory) {
            const returns = [];
            for (let i = 1; i < capitalHistory.length; i++) {
                const return_ = (capitalHistory[i] - capitalHistory[i-1]) / capitalHistory[i-1];
                returns.push(return_);
            }
            
            const mean = returns.reduce((a, b) => a + b, 0) / returns.length;
            const variance = returns.reduce((sum, return_) => sum + Math.pow(return_ - mean, 2), 0) / returns.length;
            return Math.sqrt(variance) * 100; // Convert to percentage
        }

        function updateChart(results) {
            // Pr√ºfe ob Chart.js verf√ºgbar ist
            if (typeof Chart === 'undefined') {
                console.error('Chart.js nicht verf√ºgbar - Chart kann nicht aktualisiert werden');
                return;
            }
            
            const ctx = document.getElementById('simulationChart').getContext('2d');
            
            if (simulationChart) {
                simulationChart.destroy();
            }

            const datasets = results.map(result => ({
                label: result.name,
                data: result.capitalHistory,
                borderColor: result.color,
                backgroundColor: result.color + '20',
                fill: false,
                borderWidth: result.name === 'Overbetting' ? 2 : 3,
                borderDash: result.name === 'Overbetting' ? [5, 5] : [],
                tension: 0.1,
                pointRadius: 0,
                pointHoverRadius: 4
            }));

            simulationChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 101}, (_, i) => i),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + 
                                           new Intl.NumberFormat('de-DE', {
                                               style: 'currency',
                                               currency: 'EUR',
                                               maximumFractionDigits: 0
                                           }).format(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Anzahl der Trades',
                                color: '#374151',
                                font: {
                                    size: 12,
                                    weight: '500'
                                }
                            },
                            grid: {
                                color: '#f3f4f6',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Kapital (‚Ç¨)',
                                color: '#374151',
                                font: {
                                    size: 12,
                                    weight: '500'
                                }
                            },
                            grid: {
                                color: '#f3f4f6',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280',
                                callback: function(value) {
                                    return new Intl.NumberFormat('de-DE', {
                                        style: 'currency',
                                        currency: 'EUR',
                                        maximumFractionDigits: 0
                                    }).format(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateStats(results) {
            const statsContainer = document.getElementById('simulationStats');
            
            let html = '';
            results.forEach(result => {
                const returnClass = result.totalReturn >= 0 ? 'positive' : 'negative';
                
                html += `
                    <div class="stat-card">
                        <div class="stat-label">${result.name}</div>
                        <div class="stat-value ${returnClass}">
                            ${result.totalReturn.toFixed(1)}%
                        </div>
                        <div style="font-size: 0.8rem; color: #6b7280; margin-top: 5px;">
                            Endkapital: ${new Intl.NumberFormat('de-DE', {
                                style: 'currency',
                                currency: 'EUR',
                                maximumFractionDigits: 0
                            }).format(result.finalCapital)}
                        </div>
                        <div style="font-size: 0.8rem; color: #6b7280;">
                            Max. Verlust: ${result.maxDrawdown.toFixed(1)}%
                        </div>
                    </div>
                `;
            });
            
            statsContainer.innerHTML = html;
        }

        // Scroll Animation
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, observerOptions);

        document.querySelectorAll('.section').forEach(section => {
            observer.observe(section);
        });
    </script>
{% endblock %}